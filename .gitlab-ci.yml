stages:
  - build
  - test

# Vorlage für alle Jobs: Caching und Installation
.setup-template: &setup
  image: node:20-alpine
  cache:
    key:
      files:
        - teilzeit-ausbildungsrechner/package-lock.json
    paths:
      - teilzeit-ausbildungsrechner/node_modules/
  before_script:
    - cd teilzeit-ausbildungsrechner
    - npm install

# 1. Job: BUILD (aus der 'build'-Stage)
# Wird zuerst ausgeführt
build-job:
  <<: *setup
  stage: build
  script:
    - echo "Building project with Vite..."
    - npm run build
  artifacts:
    paths:
      - teilzeit-ausbildungsrechner/dist/

# 2. Jobs: LINTER (alle aus der 'test'-Stage)
# Diese 3 Jobs laufen jetzt parallel, nachdem 'build-job' erfolgreich war.

lint-html-job:
  <<: *setup
  stage: test
  script:
    - echo "Checking HTML..."
    - npm run lint:html # Führt nur 'htmlhint .' aus

lint-css-job:
  <<: *setup
  stage: test
  script:
    - echo "Checking CSS..."
    - npm run lint:css # Führt nur 'stylelint "**/*.css"' aus

lint-js-job:
  <<: *setup
  stage: test
  script:
    - echo "Checking JavaScript..."
    - npm run lint:js # Führt nur 'eslint .' aus